## 画图

### 发送数据

#### 1. 上传图表

**用户活动**：用户选择将已经绘制的图表上传到云端

**需要发送**：

* 已经绘制图表中的数据格式为定义的数据格式，但由于新建的数据，其内部不包含数据组id，`此时需要生成数据组id以及整个数据文件并传到后端`
* 用户绘制图表所使用的模板的属性，用户可能在绘制图表时使用多个模板两种发送方式：
  * 一种是每一个模板调用对应的模板上传方法，有几个模板调用几次该模板对应的后端接口
  * 一种是发送一个模板数组，里面包含了用户所使用的全部模板，后端拿到之后自行进行判断是哪一种模板数据。

**返回值**：确认上传成功

#### 2. 导出文件

**用户活动**：用户将已经输入的数据导出txt和csv等具体格式

**需要发送**：

* 用户输入的数据，格式为图表中的数据格式所定义的数据格式
* 用户需要导出的文件格式。
* `文件的地址需要发送给后端，便于以后找到（同时可能需要后端传来上次导出位置）`

**返回值：** 

用户数据转换为具体格式文件的字节流，前端接受之后直接存储到文件中。

## 文件管理

#### 收集数据

**用户活动**

用户打开小程序时

**需要收集**

用户云端存储文件结构

**结构描述**

采用嵌套的方式进行进行描述，对于一个文件夹或者文件对象，其描述如下

```json
['path',{"obj1":attribute,"obj2":attribute}]
```

其中`path`表示当前用户当前所处位置的绝对路径。初始时为更目录

其中`{"obj1":attribute,"obj2":attribute}`存储的时当前path文件夹下的文件或者文件夹名称和相应属性

其中`attribute`用来表示文件或者文件夹对象属性,有如下域

- type: 文件类型,0/1表示，0表示文件夹，1表示文件
- size: 文件大小，文件夹置为-1，文件置为响应文件大小

- createTime：创建时间(year-month-day-hour-minute-seconds)
- modifyTime：上次修改时间(year-month-day-hour-minute-seconds)

对于

> /
> |---dir1 
> |---file1

其描述如下

```json
[
    "/",
    {'dir1':{'type':0,'size':-1,'createTime':xx,'modifyTime':xx},
    'file1':{'type':1,'size':0,'createTime':xx,'modifyTime':xx}}
]
```

#### 数据传输

用户每次修改文件或文件夹,或者切换路径时候，复制删除文件时候

#### 传输格式

```json
[order,path1,path2]
```

`order`为对应指令形式大概有如下几指令

- changDir:移动路径，path1为要移动到的路径
- rm：删除文件夹/文件，path1为要删除的文件
- cp: 复制，path1为要复制的源文件，path2为要复制到的目的文件
- cut：剪切黏贴，path1为要剪切黏贴的源文件，path2要剪切黏贴到的目的文间

**说明**

changDir,rm,cp,cut等行为对于文件或者文件夹属性改变后端可以自己定义

#### 需要的返回值

```
[state,messge,data]
```

`state`为执行状态，1表示成功，0表示失败

`messge`为返回信息，后端可以自己设计

`data`为随指令执行返回的数据，对于文件夹切换，后端需要返回用户刚刚小程序时的

```json
['path',{"obj1":attribute,"obj2":attribute}]
```

表

